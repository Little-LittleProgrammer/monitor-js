var QMONITORbrowser=function(e){"use strict";function t(e){return function(e){let t=0;if(0==e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}(e)+""}const r=/^\s*at (?:(.*?) ?\()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i;function n(e){const t=e.match(r);return t?{filename:t[2],functionName:t[1]||"",lineno:parseInt(t[3],10)||void 0,colno:parseInt(t[4],10)||void 0}:{}}function o(e){const{stack:t}=e;if(!t)return[];const r=[];for(const e of t.split("\n").slice(1)){const t=n(e);t&&r.push(t)}return r.slice(0,10)}const s=Object.prototype.toString;function i(e,t){return s.call(e)===`[object ${t}]`}function a(e){return null!==e&&i(e,"Object")}function c(e){return function(e){return e&&Array.isArray(e)}(e)||function(e){return i(e,"String")}(e)?0===e.length:e instanceof Map||e instanceof Set?0===e.size:!!a(e)&&0===Object.keys(e).length}function u(e){return"function"==typeof e}function d(e){return"undefined"!=typeof window&&i(e,"Window")}const p="undefined"!=typeof process,l=a("undefined"!=typeof wx?wx:0)&&u("undefined"!=typeof App?App:0);function f(){return!!window.PerformanceObserver}const h=d?window:l?wx:p?process:void 0,m=f();function g(e,t,r,n=!1){e.addEventListener(t,r,n)}function b(e,t,r,n=!1){e.removeEventListener(t,r,n)}function y(e,t){if(e==Window&&"complete"===document.readyState)t();else{const r=()=>{t(),b(e,"load",r,!0)};g(e,"load",r,!0)}}function v(e){return JSON.parse(JSON.stringify(e))}function w(){var e;return"undefined"==typeof document||null==document.location?"":null===(e=document.location.href)||void 0===e?void 0:e.split("?")[0]}function S(e,t){const r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=[];let o;if(t=t||r.length,e)for(o=0;o<e;o++)n[o]=r[0|Math.random()*t];else{let e;for(n[8]="-",n[13]="-",n[18]="-",n[23]="-",n[14]="4",o=0;o<36;o++)n[o]||(e=0|16*Math.random(),n[o]=r[19==o?3&e|8:e])}return n.join("")}function T(e){const t=new Set,r=JSON.stringify(e,(function(e,r){return t.has(r)?"Circular":("object"==typeof r&&t.add(r),r)}));return t.clear(),r}function x(e){return e.replace(/\b(\w)(\w*)/g,(function(e,t,r){return`${t.toUpperCase()}${r}`}))}class D{constructor(){this.stack=[]}get_cache(){return v(this.stack)}add_cache(e){this.stack.push(e)}clear_cache(){this.stack=[]}}class E{constructor(){this.cache=new Map}watch(e,t){const r=this.cache.get(e);r?this.cache.set(e,r.concat(t)):this.cache.set(e,[t])}notify(e,t){const r=this.cache.get(e);e&&r&&r.forEach((r=>{!function(e,t){try{e()}catch(e){t?t(e):console.error("err",e)}}((()=>{r(t)}),(t=>{console.error(`Subscribe.notify: 监听事件的回调函数发生错误\n\n                        eventName:${e}\n\n                        Name: ${function(e){return e&&"function"==typeof e&&e.name||"<anonymous>"}(r)}\n\n                        Error: ${t}`)}))}))}}class R extends class{constructor(){this.beforeAppAjaxSend=null,this.vue=null,this.sample=100}bindOptions(e){e.sample&&(this.sample=e.sample),e.vue&&Object.keys(e.vue).length>0&&(this.vue=e.vue),e.beforeAppAjaxSend&&u(e.beforeAppAjaxSend)&&(this.beforeAppAjaxSend=e.beforeAppAjaxSend)}}{constructor(e){super(),this.configReportXhr=null,super.bindOptions(e),this.bindOptions(e)}bindOptions(e){const{disabledPerformance:t,disabledBehavior:r,disabledError:n,disabledCustom:o,disabledConsoleError:s,disabledJsError:i,disabledPromiseError:a,disabledResourceError:c,disabledFirstPaint:d,disabledFirstContentfulPaint:p,disabledLargestContentfulPaint:l,disabledFirstInputDelay:f,disabledCumulativeLayoutShift:h,disabledNavigation:m,disabledResource:g,disabledXhr:b,disabledFetch:y,disabledFirstMeaningPaint:v,useImgUpload:w,configReportXhr:S}=e;this.disabledPerformance=t||!1,this.disabledBehavior=r||!1,this.disabledError=n||!1,this.disabledCustom=o||!1,this.disabledXhr=b||!1,this.disabledFetch=y||!1,this.disabledFirstMeaningPaint=v||!1,this.disabledConsoleError=s||!1,this.disabledJsError=i||!1,this.disabledPromiseError=a||!1,this.disabledResourceError=c||!1,this.disabledFirstPaint=d||!1,this.disabledFirstContentfulPaint=p||!1,this.disabledLargestContentfulPaint=l||!1,this.disabledFirstInputDelay=f||!1,this.disabledCumulativeLayoutShift=h||!1,this.disabledNavigation=m||!1,this.disabledResource=g||!1,this.useImgUpload=w||!1,S&&u(S)&&(this.configReportXhr=S)}}function O(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}function U(){if(window.navigator.connection){const e=window.navigator.connection;return{effectiveType:e.effectiveType,downlink:e.downlink,rtt:e.rtt,saveData:e.saveData}}return null}class L extends class{constructor(){this.url="",this.appID="",this.userID="",this.appName="",this.cacheNum=50,this.beforeDataReport=null,this.timer=null,this.queue=new D,this.submitErrorUids=[]}bindOptions(e){this.appID=e.appID,this.url=e.url,e.appName&&(this.appName=e.appName),e.cacheNum&&(this.cacheNum=e.cacheNum),e.userID?this.userID=e.userID:this.userID=function(){let e="";return d?(e=localStorage.getItem("uuid"),e||(e=S(16),localStorage.setItem("uuid",e),e)):l?(e=wx.getStorageSync("uuid"),e||(e=S(16),wx.setStorageSync("uuid",e),e)):void 0}()}send(e,t=!1){return function(e,t,r,n){return new(r||(r=Promise))((function(o,s){function i(e){try{c(n.next(e))}catch(e){s(e)}}function a(e){try{c(n.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,a)}c((n=n.apply(e,t||[])).next())}))}(this,void 0,void 0,(function*(){if(e.extraData&&e.extraData.errorUid){if(this.submitErrorUids.indexOf(e.extraData.errorUid)>-1)return;this.submitErrorUids.push(e.extraData.errorUid)}let r=Object.assign({},this.formatReportData(e));if(r=Object.assign({},this.getReportData(r)),!u(this.beforeDataReport)||(r=yield this.beforeDataReport(r),r)){if(!c(this.url))return this.sendTime(r,this.url,t);console.error("请设置上传 URL 地址")}}))}formatReportData(e){return{id:S(16),appID:this.appID,userID:this.userID,appName:this.appName,data:e}}sendTime(e,t,r){r?this.report(e,t):(this.queue.add_cache(e),clearTimeout(this.timer),this.timer=setTimeout((()=>{const e=this.queue.get_cache();e&&e.length>=this.cacheNum&&(this.report(e,t),this.queue.clear_cache())}),3e3))}}{constructor(e){super(),this.configReportXhr=null,this.useImgUpload=!1,super.bindOptions(e),this.bindOptions(e)}post(e,t){const r=new XMLHttpRequest;r.open("post",t),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.withCredentials=!0,this.configReportXhr&&u(this.configReportXhr)&&this.configReportXhr(r,e),r.send(T(e))}imgRequest(e,t){let r=new Image;const n=-1===t.indexOf("?")?"?":"&";r.src=`${t}${n}data=${encodeURIComponent(T(e))}`,r=null}beaconPost(e,t){h.navigator.sendBeacon.call(window.navigator,t,T(e))}report(e,t){let r=null;r=this.useImgUpload?this.imgRequest:h.navigator&&h.navigator.sendBeacon?this.beaconPost:this.post,h.requestIdleCallback?h.requestIdleCallback((()=>O(this,void 0,void 0,(function*(){yield r(e,t)})))):setTimeout((()=>O(this,void 0,void 0,(function*(){yield r(e,t)}))))}getReportData(e){return Object.assign(Object.assign({},e),{networkInfo:U()})}bindOptions(e){this.useImgUpload=e.useImgUpload||!1,e.configReportXhr&&u(e.configReportXhr)&&(this.configReportXhr=e.configReportXhr)}}class j extends class{constructor(e){this.options=e}use(e){const t=new E;e.forEach((e=>{this.isPluginsEnable(e.type)&&this.isPluginEnable(e.name)&&(e.monitor.call(this,t.notify.bind(t)),t.watch(e.name,((...t)=>{var r,n;const o=null===(r=e.transform)||void 0===r?void 0:r.apply(this,t);null===(n=e.consumer)||void 0===n||n.call(this,o)})))}))}getOptions(){return this.options}log(e,t=!1){const r=Object.assign({},e);r.startTime=Date.now(),r.pageURL||(r.pageURL=w()),this.report.send(e,t)}}{constructor(e){super(e),this.options=new R(e),this.report=new L(e)}isPluginEnable(e){const t=`disabled${function(e){const t=e.split("-");let r="";return t.forEach((e=>{r+=x(e)})),r}(e)}`;return!this.options[t]}isPluginsEnable(e){const t=`disabled${x(e)}`;return!this.options[t]}}const I={name:"console-error",type:"error",monitor(e){h.console.error=(...t)=>{e("console-error",t)}},transform:e=>({type:"error",subType:"console-error",pageURL:w(),extraData:{type:"",errorUid:t(`console-error-${e[0]}`),msg:e.join(";"),meta:void 0,stackTrace:void 0}}),consumer(e){this.report.send(e,!0)}},N={name:"js-error",type:"error",monitor(e){g(h,"error",(t=>{t.target.localName||(t.preventDefault(),e("js-error",t))}),!0)},transform:e=>function(e){return{type:"error",subType:"js-error",pageURL:w(),extraData:{type:e.error&&e.error.name||"UnKnown",errorUid:t(`js-error-${e.message}-${e.filename}`),msg:e.stack||e.message,meta:{file:e.filename,col:e.colno,row:e.lineno},stackTrace:{frames:o(e.error)}}}}(e),consumer(e){this.report.send(e,!0)}},P={name:"resource-error",type:"error",monitor(e){g(h,"error",(t=>{t.target.localName&&(t.preventDefault(),e("resource-error",t))}),!0)},transform:e=>function(e){const r=e.src||e.href;return{type:"error",subType:"resource-error",pageURL:w(),extraData:{type:"resource-error",errorUid:t(`resource-error-${e.src}-${e.tagName}`),msg:"资源地址: "+r,meta:{url:r,html:e.outerHTML,type:e.tagName},stackTrace:void 0}}}(e.target),consumer(e){this.report.send(e,!0)}};const C={name:"promise-error",type:"error",monitor(e){g(h,"unhandledrejection",(t=>{e("promise-error",t)}))},transform(e){const r=e.reason.stack||e.reason.message||e.reason,n=e.reason.name||"UnKnown";return{type:"error",subType:"promise-error",pageURL:w(),extraData:{type:n,errorUid:t(`promise-error-${r}`),msg:r,meta:void 0,stackTrace:{frames:o(e.reason)}}}},consumer(e){this.report.send(e,!0)}},A={name:"fetch",type:"performance",monitor(e){q.call(this,e)},transform:e=>e,consumer(e){this.report.send(e)}},k=h.fetch;function q(e){const{options:t}=this;"fetch"in h&&(h.fetch=(r,n={})=>{const o=Date.now(),s=(n&&n.method||"GET").toUpperCase(),i={type:"performance",subType:"fetch",pageURL:w(),extraData:{startTime:o,url:r,method:s,data:n.body}},a=new Headers(n.headers||{});return Object.assign(a,{setRequestHeader:a.set}),t.beforeAppAjaxSend&&t.beforeAppAjaxSend({url:r,method:s},a),k(r,n).then((t=>{const r=t.clone(),n=Date.now();return i.extraData=Object.assign(Object.assign({},i.extraData),{endTime:n,duration:n-i.extraData.startTime,status:r.status,success:r.ok}),r.text().then((()=>{e("fetch",i)})),t})).catch((t=>{const r=Date.now();throw i.extraData=Object.assign(Object.assign({},i.extraData),{endTime:r,duration:r-i.extraData.startTime,status:0,success:!1}),e("fetch",i),t}))})}const M={name:"xhr",type:"performance",monitor(e){$.call(this,e)},transform:e=>e,consumer(e){this.report.send(e)}};function $(e){const{options:t}=this;if(!("XMLHttpRequest"in h))return;const r=XMLHttpRequest.prototype,n=r.open,o=r.send;r.open=function(...e){var t,r;this.url=null===(r=null===(t=e[1])||void 0===t?void 0:t.split("?"))||void 0===r?void 0:r[0],this.method=e[0],n.apply(this,e)},r.send=function(...r){this.startTime=Date.now(),t.beforeAppAjaxSend&&t.beforeAppAjaxSend({method:this.method,url:this.url},this);const n=()=>{this.endTime=Date.now(),this.duration=this.endTime-this.startTime;const{status:t,duration:r,startTime:o,endTime:s,url:i,method:a}=this,c={type:"performance",subType:"xhr",extraData:{status:t,duration:r,startTime:o,endTime:s,url:i,method:(a||"GET").toUpperCase(),success:t>=200&&t<300},pageURL:w()};e("xhr",c),b(this,"loadend",n,!0)};g(this,"loadend",n,!0),o.apply(this,r)}}const X={name:"cumulative-layout-shift",type:"performance",monitor(e){if(!f())return;let t=0,r=[];const n={type:"performance",subType:"cumulative-layout-shift",pageURL:"",extraData:{value:0}};function o(o){n.pageURL=w();for(const s of o.getEntries()){const o=s;if(!o.hadRecentInput){const i=r[0],a=r[r.length-1];t&&s.startTime-a.startTime<1e3&&s.startTime-i.startTime<5e3?(t+=o.value,r.push(B(s))):(t=o.value,r=[B(s)]),t>n.extraData.value&&(n.extraData={entry:o,value:t,entries:r},e("cumulative-layout-shift",v(n)))}}}const s=new PerformanceObserver(o);s.observe({type:"layout-shift",buffered:!0}),s&&function(e,t,r=!1){const n=o=>{"pagehide"!==o.type&&"hidden"!==document.visibilityState||(t(o),r&&(b(e,"visibilitychange",n,!0),b(e,"pagehide",n,!0)))};g(e,"visibilitychange",n,!0),g(e,"pagehide",n,!0)}(h,(()=>{s.takeRecords().map(o)}))},transform:e=>e,consumer(e){this.report.send(e)}};function B(e){const t=e.toJSON();return delete t.duration,delete t.sources,t}const z={name:"first-input-delay",type:"performance",monitor(e){if(!m)return;const t=new PerformanceObserver((function(r){t&&t.disconnect();for(const t of r.getEntries()){const r={type:"performance",subType:"first-input-delay",pageURL:w(),extraData:Object.assign({},t.toJSON())};e("first-input-delay",r)}}));t.observe({type:"first-input",buffered:!0})},transform:e=>e,consumer(e){this.report.send(e)}};let F=!1;const H={name:"largest-contentful-paint",type:"performance",monitor(e){if(!m)return void(F=!0);const t=new PerformanceObserver((function(r){F=!0,t&&t.disconnect();for(const t of r.getEntries()){const r={type:"performance",subType:"largest-contentful-paint",pageURL:w(),extraData:Object.assign({},t.toJSON())};e("largest-contentful-paint",r)}}));t.observe({type:"largest-contentful-paint",buffered:!0})},transform:e=>e,consumer(e){this.report.send(e)}};let J,_=!1;y(h,(()=>{_=!0}));const G=[],K={name:"first-meaning-paint",type:"performance",monitor(e){if(!MutationObserver)return;const t=window.requestAnimationFrame?requestAnimationFrame:setTimeout,r=["STYLE","SCRIPT","LINK","META"];J=new MutationObserver((n=>{Q(e);const o={startTime:0,children:[]};t((()=>{o.startTime=performance.now()}));for(const e of n)if(e.addedNodes.length)for(const t of[...e.addedNodes])1!==t.nodeType||r.includes(t.tagName)||V(t,o.children)||o.children.push(t);o.children.length&&G.push(o)})),J.observe(document,{childList:!0,subtree:!0})},transform:e=>e,consumer(e){this.report.send(e)}};let W=null;function Q(e){clearTimeout(W),W=setTimeout((()=>{if(F&&_){J&&J.disconnect();const t={type:"performance",subType:"first-meaning-paint",pageURL:w(),extraData:{startTime:Y()}};e("first-meaning-paint",t)}else Q(e)}),500)}function Y(){let e=0;return G.forEach((t=>{for(const r of t.children)if(Z(r)&&t.startTime>e&&ee(r)){e=t.startTime;break}})),performance.getEntriesByType("resource").forEach((t=>{"img"===t.initiatorType&&t.fetchStart<e&&t.responseEnd>e&&(e=t.responseEnd)})),e}function V(e,t){return!(!e||e===document.documentElement)&&(!!t.includes(e)||V(e.parentElement,t))}function Z(e){const t=window.innerWidth,r=window.innerHeight,n=e.getBoundingClientRect();return n.left>=0&&n.left<t&&n.top>=0&&n.top<r}function ee(e){return"none"!==window.getComputedStyle(e).display&&!("IMG"===e.tagName&&e.width<2&&e.height<2)}const te={name:"first-paint",type:"performance",monitor(e){if(!m)return;const t=new PerformanceObserver((function(r){for(const n of r.getEntries()){"first-contentful-paint"===n.name&&t.disconnect();const r={type:"performance",subType:n.name,pageURL:w(),extraData:Object.assign({},n.toJSON())};e("first-paint",r)}}));t.observe({type:"paint",buffered:!0})},transform:e=>e,consumer(e){this.report.send(e)}},re={name:"resource",type:"performance",monitor(e){m&&y(h,(()=>se.call(this,"resource",e)))},transform(e){const t={type:"performance",subType:"resource",extraData:{},pageURL:""};return t.extraData={name:e.name.split("/")[e.name.split("/").length-1],sourceType:e.initiatorType,ttfb:e.responseStart,transferSize:e.transferSize,protocol:e.nextHopProtocol,encodedBodySize:e.encodedBodySize,decodedBodySize:e.decodedBodySize,resourceRatio:e.decodedBodySize/e.encodedBodySize||1,isCache:ae(e),startTime:performance.now(),redirect:e.redirectEnd-e.redirectStart,dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,request:e.responseStart-e.requestStart,response:e.responseEnd-e.responseStart,duration:e.duration},t},consumer(e){this.report.send(e)}},ne={name:"navigation",type:"performance",monitor(e){m&&y(h,(()=>se.call(this,"navigation",e)))},transform(e){const t={type:"performance",subType:"navigation",extraData:{},pageURL:""};return t.pageURL=w(),t.extraData={fp:e.responseEnd-e.fetchStart,tti:e.domInteractive-e.fetchStart,domReady:e.domContentLoadedEventEnd-e.fetchStart,load:e.loadEventStart-e.fetchStart,firstByte:e.responseStart-e.domainLookupStart,dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ssl:e.secureConnectionStart?e.connectEnd-e.secureConnectionStart:0,ttfb:e.responseStart-e.requestStart,trans:e.responseEnd-e.responseStart,domParse:e.domInteractive-e.responseEnd,res:e.loadEventStart-e.domContentLoadedEventEnd},t},consumer(e){this.report.send(e)}};let oe=!1;function se(e,t){const r=new PerformanceObserver((function(n){for(const s of n.getEntries()){const n=s;if("navigation"===e){if(oe)return;r&&r.disconnect(),oe=!0}if(!n.nextHopProtocol&&"navigation"!==e||(o=n.initiatorType,ie.includes(o)))return;t(e,n)}var o}));r.observe({type:e,buffered:!0})}const ie=["fetch","xmlhttprequest","beacon"];function ae(e){return 0===e.transferSize||0!==e.transferSize&&0===e.encodedBodySize}/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&ie.push("other");const ce=function(e={},t=[]){const r=new j(e),n=r.getOptions().sample;let o=[I,N,P,C];if(s=n,100*Math.random()<=s){o=[...o,M,A,X,z,K,te,H,re,ne];!function(e,t){e.addEventListener("beforeunload",t,!0)}(h,(()=>{const e=r.report.queue.get_cache();e&&e.length>0&&(r.report.post(e,r.report.url),r.report.queue.clear_cache())}))}var s;return r.use([...o,...t]),r};return e.BrowserClient=j,e.init=ce,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
